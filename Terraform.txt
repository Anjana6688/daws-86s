Why not Ansible is used for Infra?

Ansible can create infra, but it can't manage/update infra because of no state management feature available in ansible, originally created for configuration management not good for infra management..
Use terraform for infra creation, once servers are created by terraform handover them to ansible, ansible completes configuration in the server

Terraform: Terraform is an open-source Infrastructure as Code (IaC) tool created by HashiCorp,HCL -> Hashicorp configuration language

Key features and benefits:
=================================
Version control
Automatic CRUD
Consistent infra -> DEV, QA, UAT, PRE-PROD, PERF, PROD
Inventory -> What are the services we are using in cloud
Cost optimisation
Time saving and no human errors
Dependency -> SG, EC2 and then R53
Modular reusable infra
Session-30
================
Hashicorp configuration language syntax:
--------------------------------------------
{
key ="value"
}

resource "type_of_resource" "name-of-resource" {
	
	key = value
	
}

terraform init -> downloads the provider, intialise terraform
We need to use terraform provider.tf code in our repository then need to use this command .
you can find the code in https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance
COMMANDS:
----------
terraform plan -> It will give us a plan that what it is going to do
terraform apply -> creates the infra as given in the plan
terraform apply -auto-approve
terraform destroy -auto-approve

Variables:
==============
Syntax for vailable:

variable "variable_name" {
	default = "value-of-variable"
}

If you neeed to call the variable use var.variable_name
Note: Variable names should be anything our wish but when we give resource name thats should be as in terraform 

We have written sample code for creating ec2 and security groups reference from terraform doc.
Also variable priority like 
1. command line variable values have first prefernce
2. terraform.tfvars (this we need to give same file no changes to be done.
3. env variable TF_VAR_<variable_name>
4. default value
5. finally prompt

which means if you define an existing variable in cmd it will take the value from command line.
you can check with terraform doc for cmd line.

Conditions:
============
Condition-syintax condition ? true_value : false_value

in variable.tf i have defined as variable 
variable "environment" {
    default = "dev"
}
then i have added a condition in ec2.tf like
    instance_type = var.environment == "dev" ? "t3.micro" : "t3.medium" 
then the variable i have defined as dev so after i have applied the terraform plan then then i can get the t3.micro instance as that is the true conditon.

terraform Plan -Output 
instance_state                       = (known after apply)
      + instance_type                        = "t3.micro"
 Loops
==========================================================
count:
======
In Terraform there count word which will represents a loop and create multiple environments..
wheneverwe use count it will give special variable count.index.
It works with List more frequently.
SO i have created three instances with different names for that i have done
i have created a variable.tf
variable "instances" {
    default = [ "Mongodb", "Reddis", "Mysql" ]
}
and in loop.tf
tags = {
        Name = var.instances[count.index]
        Terraform = "true"
    }

I have added the count.index which means when index is 0 then it will create Mongodb. viseversa forother index as well.
DATE: 05-11-2025
Till now we have created a three instances for that now we are creating records.
for that we are using this code https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record
aws route53 records.
In route 53.tf we have combined two variables.
name    = "var.instances[count.index].var.domain"
we have combined two variables this concept calls Interpolation.
Interpolation/concatination:
===========================
To do concatination of variables we use use ${variable}
name    = "${var.instances[count.index]}.${var.domain}"

/*******Session -30 -completed in this sessioon we have create loop,records and instances using that loop.***/
How to check the output iof resource???
We can give awsintance.terraform in output.tf file when we give terrafom apply command it will show the output
which(awsintance.terraform) means type_of_resource.name_of_resource.
FOR-LOOP:
=========
       Count basedd loop are used to itterates list,where as for loops are used for map.
	   List consists "string values"
	   Map consists "Key and values"[suppose if you define front-end ="ip-address" here front-end is KEY and ip-address is VALUE]
	   The for_each meta-argument accepts a map or a set of strings and creates an instance for each item in that map or set.
	   Map always consists key value pairs.
	  syntax for map:
	  -------------
	      {
		     key = value
			 key2=value2
		   }
		   
	      key = value,this entire entry is taken as one each statement so each.key and each.value it will consider whenever for_each itterates.
		  if we want to declare multiple values we use list but to use it in for_each we need to convert it to string by using  toset() and tomap() or we can use Map.
		  By using we are converting the list so map need key-value so we are converting the below list to map 
           		  variable "instances" {
					default = {
        mongodb="t3.micro"
        redis="t3.micro"
        mysql="t2.micro"

    }
}

     here terraform sample code from docs
	 resource "azurerm_resource_group" "rg" {
  for_each = tomap({
    a_group       = "eastus"
    another_group = "westus2"
  })
  name     = each.key
  location = each.value
}

Our modified code 

resource "aws_instance" "terraform" {
    ami = "ami-09c813fb71547fc4f"
	for_each =var.instances
    instance_type = "t3.micro"
    vpc_security_group_ids = [aws_security_group.allow_all.id]
    tags = {
        Name = "terraform-1"
        Terraform = "true"
    }
}
NOTE: count is suitable for itterae list we will get count.index
for_each is good for map we will get eack.key and each.value
if u want to irrerate list through for_each then we can use
for_each = toset(list) we ned to call it via each.value

Data Sources:
==============
  We can query the existing information in the provider using data sources.
  Suppose if we give any hardcoded values in tf files if any changes in infrastructure then it will be difficult to 
  and if terraform run the files it will fail because in background the existing hardcoded values are changed.
  To avoid this terraform has data sources it will dynamically fetch the information.
 How Data Sources Work:
  A data source is declared using a data block, followed by the provider name, the type of data to retrieve,
  and a local name you assign for referencing it within your configuration.
    These attributes can be referenced elsewhere in your Terraform configuration using the syntax data.<PROVIDER>_<TYPE>.<NAME>.<ATTRIBUTE>.
	By using data sources even if any backround changes done it will dynamically pick those changes no need to update manually.
	 if you want to see the output you can check the output using output in terraform.
	 output "ami_id" {
    value = data.aws_ami.joindevops.id
	the above line will give the full info about existing ami .
	TIP: Data will give the data of existing resource where as resource will create the data.
	ex for resource:
	----------------
	resource "aws_instance" "terraform" {
#   for_each =var.instances
#     ami = data.aws_ami.joindevops.id  # data.<PROVIDER>_<TYPE>.<NAME>.<ATTRIBUTE>.
#     instance_type = each.value
#     vpc_security_group_ids = [aws_security_group.allow_all.id]
#     tags = {
#         Name = each.key
#         Terraform = "true"
#     }
# }  
 example for Data:
 ----------------
 data "aws_ami" "joindevops" {
    owners           = ["973714476881"]
    most_recent      = true
    }

functions:
==========
 Terraform functions are inbuilt we need to use the existing function no possibility to create new functions.
 length:
 most of the case if we want to create 2 number of instance in resource we will define the count =2 in furture if we want to increate the length
 instead we can use length(var.instance)
 refer link for functions:https://developer.hashicorp.com/terraform/language/functions
 $ terraform console
> max(12, 54, 3)
54
> join("-", ["foo", "bar", "baz"])
"foo-bar-baz"
>

 Merge function:
 -------------
 it will merge the two Maps.
 while merging maps if any new values that should be create and if it is already existing that will replace with new Map Values.
 
 State **********Imp Concept*******
 ==================================
 The responsibility of terraform is whatever we have given in .tf files it should be created. 
 wich means we are declaring that to create infra..
 How terraform will know that if instance is already created?
 Terraform is stores in state file,it will uses this file to track whether the given input is created or need to be created.
 
 1.  .tf files--> This we are giving our expected/declared input
 2.Actual infra --> existing or real infra 
 3.state --> for comparision terraform creates.
 
 Scenarios:1
 ===========
 No state file means there is no infra terraform will create infra
 and for tracking it will create .tfstate file.
 scenarion2:
 ===========
 If you are running same tf file again then terraform will refresh 
 aws_security_group.allow_all: Refreshing state...
 it will compare actual infra vs state file
nothing to change
Scenario 3:
===========
Mnaually deleting the instance in console
if you give terraform Plan...
Refressibg statee....in this refressing process terraform will validate the tfstate file and our provider have same inputs if it is not there it will  modify the
terraform tfstate file accordingly after apply/plan.

scenario 4:
===========

Changed some thing in tf files(our input)
In that terraform will validate whether .tf file is matching with actual infra if not matches and then again chnage accordingly in .tfstate file.

Terraform state definition:
============================
Terraform state is used to match the desired infra to match the actual infra,
when create,read,update and delete the infra terraform uses this state file to acheive 
the desired infra for comparision. It is like memory to terraform
 
 Resource Mapping: It stores the bindings between resources declared in your configuration and the actual objects in the remote system (e.g., an AWS EC2 instance, an Azure Virtual Machine).
 
 NOTE: Terraform locks the state file when terraform is running.

/******************************* SESSION :32********************************/
13/11/2025:





